%link{:href => "http://twitter.github.com/bootstrap/assets/js/google-code-prettify/prettify.css", :rel => "stylesheet"}
%link{:href => "http://netdna.bootstrapcdn.com/twitter-bootstrap/2.3.1/css/bootstrap-combined.no-icons.min.css", :rel => "stylesheet"}
%link{:href => "http://netdna.bootstrapcdn.com/twitter-bootstrap/2.3.1/css/bootstrap-responsive.min.css", :rel => "stylesheet"}
%link{:href => "http://netdna.bootstrapcdn.com/font-awesome/3.0.2/css/font-awesome.css", :rel => "stylesheet"}

- title, categories = octopress_parse(@post_path, params[:post])
%title 编辑Markdown

.container
  .row
    .col-sm-12{style: "text-align:center;"}
      .loading.hidden 加载中...
      = notice_message
  .row
    .span11.offset1
      .row{style: "margin: 10px 0px;"}
        .span8
          %h2= "编辑[#{title}]"

        .span2{style: "margin-top: 20px;"}
          %a.right.btn.btn-default{href: "/blogs/show?post=#{params[:post]}",  "data-toggle" => "tooltip", "data-original-title" => "查看该博文"}
            %span.icon-eye-open
          %a.right.btn.btn-default{href: "/blogs", "data-toggle" => "tooltip", "data-original-title" => "返回博文列表"}
            %span.icon-list
          %a.right.btn.btn-default{"data-toggle" => "modal", "data-target" => "#modalMarkdownCheatsheet"}
            %span.icon-question-sign

  .row
    .span8.offset1
      %form.form-horizontal{"accept-charset" => "UTF-8", :action => "/blogs/update", :method => "post", :style => "display:inline;width:100px;"}
        = haml :"_toolbar", layout: false
        %input{name: "post", value: "#{params[:post]}", type: "hidden"}
        %textarea#editor{name: "content", contenteditable: "true", style: "width:100%;height:100%;"}= @content
        %pre.hidden= @content
        %input.btn.btn-primary{type: "submit", style: "float:right;"}

    .span3{style: "margin-left:15px;"}
      .row{style: "margin-top:10px;margin-bottom:10px;margin-left:15px;"}
        %form.form-horizontal{"accept-charset" => "UTF-8", :action => "/blogs/image?post=#{params[:post]}", :enctype => "multipart/form-data", :method => "post", :style => "display:inline;width:100px;"}
          %span.btn.btn-success.fileinput-button
            %i.icon-plus
            %span 添加图片
            %input.text_field{:name => "image", :onchange => "$('#image_submit').trigger('click');", :type => "file", :style => "width: 150px;"}
          %input.btn{:name => "commit", :style => "display:none;", :type => "submit", :value => "submit", :id => "image_submit"}
      .row{style: "max-height:600px;overflow:auto;margin-left:15px;"}
        - post_images(params[:post]).each_with_index do |img, i|
          .row{style: "margin-left:0px;", class: "img-#{i}"}
            .row{style: "margin-left:0px;"}
              %a{"data-toggle" => "tool-tip", "data-original-title" => "#{img}"}
                %img{src: "#{img_url_path(img)}", style: "width:200px;display:inline;"}
            .row{style: "margin-left:0px;"}
              %input.span2{id: "img_url_#{i}", readonly: "readonly", value: "#{img}", style: "width:200px;height:25px;padding:6px 3px;",onclick: "this.setSelectionRange(0, this.value.length)"}

:css
  .right {
    float: right;
  }
  #editor { 
    white-space: pre-wrap;
    overflow: scroll; 
    min-height:200px;
    max-height: 600px;
    background-color: white;
    border-collapse: separate; 
    border: 1px solid rgb(204, 204, 204); 
    padding: 4px; 
    box-sizing: content-box; 
    -webkit-box-shadow: rgba(0, 0, 0, 0.0745098) 0px 1px 1px 0px inset; 
    box-shadow: rgba(0, 0, 0, 0.0745098) 0px 1px 1px 0px inset;
    border-top-right-radius: 3px; border-bottom-right-radius: 3px;
    border-bottom-left-radius: 3px; border-top-left-radius: 3px;
    overflow: scroll;
    outline: none;
  }

  .fileinput-button {
    position: relative;
    overflow: hidden;
    float: left;
    margin-right: 4px;
  }
  .fileinput-button input {
    position: absolute;
    top: 0;
    right: 0;
    margin: 0;
    border: solid transparent;
    border-width: 0 0 100px 200px;
    opacity: 0;
    filter: alpha(opacity=0);
    -moz-transform: translate(-300px, 0) scale(4);
    direction: ltr;
    cursor: pointer;
  }
  /* Fix for IE 6: */
  * html .fileinput-button {
    line-height: 22px;
    margin: 1px -3px 0 0;
  }
  /* Fix for IE 7: */
  * + html .fileinput-button {
    margin: 1px 0 0 0;
  }

%script{:src => "http://cdn.bootcss.com/jquery/1.9.1/jquery.min.js"}
%script{:src => "https://mindmup.s3.amazonaws.com/lib/jquery.hotkeys.js"}
%script{:src => "http://cdn.bootcss.com/twitter-bootstrap/2.3.1/js/bootstrap.min.js"}
= javascript_include_tag "http://solfie-cdn.qiniudn.com/jquery.zclip-1.1.1.min.js"
= javascript_include_tag "#{Settings.cdn.bootstrap_wysiwyg}"
= javascript_include_tag "/javascripts/blog.js"
:javascript
  $(function(){
    $("#editor").wysiwyg();
    $("#editor").html($("pre").html());
    $("body").tooltip({selector: "a[data-toggle=tooltip]"});
  })

= haml :"_markdown_cheatsheet", layout: false

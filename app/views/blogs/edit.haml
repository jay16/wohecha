%link{:href => "http://twitter.github.com/bootstrap/assets/js/google-code-prettify/prettify.css", :rel => "stylesheet"}
%link{:href => "http://netdna.bootstrapcdn.com/twitter-bootstrap/2.3.1/css/bootstrap-combined.no-icons.min.css", :rel => "stylesheet"}
%link{:href => "http://netdna.bootstrapcdn.com/twitter-bootstrap/2.3.1/css/bootstrap-responsive.min.css", :rel => "stylesheet"}
%link{:href => "http://netdna.bootstrapcdn.com/font-awesome/3.0.2/css/font-awesome.css", :rel => "stylesheet"}

- title, categories = octopress_parse(@post_path, params[:post])
%title 编辑Markdown

.container
  .row
    .col-sm-12{style: "text-align:center;"}
      .loading.hidden 加载中...
      = notice_message
  .row
    .span11.offset1
      .row{style: "margin: 10px 0px;"}
        %h2= "编辑[#{title}]"

        %a.btn.btn-default{href: "/blogs", style: "float:right;margin-top: -35px;margin-right:40px;", "data-toggle" => "tooltip", "data-original-title" => "返回博文列表"}
          %span.icon-list
        %a.btn.btn-default{href: "/blogs/show?post=#{params[:post]}", style: "float:right;margin-top: -35px;", "data-toggle" => "tooltip", "data-original-title" => "查看该博文"}
          %span.icon-eye-open

  .row
    .span8.offset1
      %form.form-horizontal{"accept-charset" => "UTF-8", :action => "/blogs/update", :method => "post", :style => "display:inline;width:100px;"}
        = haml :"_toolbar", layout: false
        %input{name: "post", value: "#{params[:post]}", type: "hidden"}
        %textarea#editor{name: "content", contenteditable: "true", style: "width:100%;height:100%;"}= @content
        %pre.hidden= @content
        %input.btn.btn-primary{type: "submit", style: "float:right;"}

    .span3{style: "margin-left:15px;"}
      .row{style: "margin-top:20px;margin-left:15px;"}
        %form.form-horizontal{"accept-charset" => "UTF-8", :action => "/blogs/image?post=#{params[:post]}", :enctype => "multipart/form-data", :method => "post", :style => "display:inline;width:100px;"}
          %input.text_field{:name => "image", :onchange => "$('#image_submit').trigger('click');", :type => "file", :style => "width: 150px;"}
            %input.btn{:name => "commit", :style => "display:none;", :type => "submit", :value => "submit", :id => "image_submit"}
      .row{style: "max-height:500px;overflow:auto;margin-left:15px;"}
        - post_images(params[:post]).each_with_index do |img, i|
          .row{style: "margin-left:0px;"}
            %a{"data-toggle" => "tool-tip", "data-original-title" => "#{img}"}
              %img{src: "#{url_path(img)}", style: "width:200px;display:inline;"}
          .row{style: "margin-left:0px;"}
            .input-append
              %input.span2{id: "img_url_#{i}", readonly: "readonly", value: "#{img}", style: "height:25px;padding:6px 3px;"}
              %span.add-on{style: "height:15px;padding:3px;"}
                %a{onclick: "Blog.zclipFun(this, #{i});", href: "#", "data-toggle" => "tool-tip", "data-placement" => "top", "data-original-title" => "复制图片地址-#{img}"}
                  %span.icon-share

:css
  #editor { 
    white-space: pre-wrap;
    overflow: scroll; 
    min-height:200px;
    max-height: 500px;
    background-color: white;
    border-collapse: separate; 
    border: 1px solid rgb(204, 204, 204); 
    padding: 4px; 
    box-sizing: content-box; 
    -webkit-box-shadow: rgba(0, 0, 0, 0.0745098) 0px 1px 1px 0px inset; 
    box-shadow: rgba(0, 0, 0, 0.0745098) 0px 1px 1px 0px inset;
    border-top-right-radius: 3px; border-bottom-right-radius: 3px;
    border-bottom-left-radius: 3px; border-top-left-radius: 3px;
    overflow: scroll;
    outline: none;
  }
%script{:src => "http://cdn.bootcss.com/jquery/1.9.1/jquery.min.js"}
%script{:src => "https://mindmup.s3.amazonaws.com/lib/jquery.hotkeys.js"}
%script{:src => "http://cdn.bootcss.com/twitter-bootstrap/2.3.1/js/bootstrap.min.js"}
= javascript_include_tag "http://solfie-cdn.qiniudn.com/jquery.zclip-1.1.1.min.js"
= javascript_include_tag "#{Settings.cdn.bootstrap_wysiwyg}"
= javascript_include_tag "/javascripts/blog.js"
:javascript
  $(function(){
    $("#editor").wysiwyg();
    $("#editor").html($("pre").html());
    $("body").tooltip({selector: "a[data-toggle=tooltip]"});
  })
